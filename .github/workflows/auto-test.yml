name: Automated test
permissions:
  contents: read
  
on:
  push:
    branches: [ "master" ]

jobs:
  Linux_x86-64_GCC:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: build angelscript
      run: |
        cd $GITHUB_WORKSPACE/sdk/angelscript/projects/gnuc
        make
    - name: build test_feature
      run: |
        cd $GITHUB_WORKSPACE/sdk/tests/test_feature/projects/gnuc
        make
    - name: run test_feature
      run: |
        cd $GITHUB_WORKSPACE/sdk/tests/test_feature/bin
        ./testgnuc

  Windows_x86-64_Clang:      
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - name: set up Clang
      uses: egor-tensin/setup-clang@v1
      with:
       version: latest
       platform: x64
       cc: 1
    - name: build angelscript & test_feature
      shell: powershell
      run: |
        cd $env:GITHUB_WORKSPACE/sdk/tests/test_feature/projects/cmake
        cmake . -G Ninja -T clang
        cmake --build . --config Release
    - name: run test_feature
      shell: powershell
      run: |
        cd $env:GITHUB_WORKSPACE/sdk/tests/test_feature/bin
        release/test_feature.exe


        
